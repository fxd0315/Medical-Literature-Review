<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>医学文献综述助手 - 联网版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .animate-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    <div id="app"></div>

    <script>
        // Mock Database (Fallback)
        const MOCK_PAPERS = [
            {
                id: 'mock-1',
                title: "Efficacy and Safety of Mazdutide in Chinese Patients with Type 2 Diabetes",
                authors: "Ji L, et al.",
                journal: "Nature Communications",
                year: 2023,
                if: 16.6,
                jcr: "Q1",
                citationCount: 45,
                keywords: ["diabetes", "mazdutide", "glp-1", "糖尿病"],
                abstract: "Mazdutide, a GLP-1/GCGR dual agonist, showed significant improvements in glycemic control and body weight reduction.",
                summaryPoint: "玛仕度肽在中国2型糖尿病患者中显示出优异的降糖和减重效果。"
            },
            {
                id: 'mock-2',
                title: "Semaglutide in overweight or obesity and prediabetes (STEP 10)",
                authors: "Perreault L, et al.",
                journal: "Lancet Diabetes Endocrinol",
                year: 2024,
                if: 44.5,
                jcr: "Q1",
                citationCount: 120,
                keywords: ["obesity", "semaglutide", "肥胖"],
                abstract: "Semaglutide 2.4 mg led to larger body weight reductions and greater reversion to normoglycemia.",
                summaryPoint: "司美格鲁肽能显著逆转糖尿病前期状态并降低体重。"
            },
            {
                id: 'mock-3',
                title: "Global burden of hypertension from 90 countries",
                authors: "Mills KT, et al.",
                journal: "The Lancet",
                year: 2022,
                if: 168.9,
                jcr: "Q1",
                citationCount: 850,
                keywords: ["hypertension", "高血压", "流行病学"],
                abstract: "Analysis highlights increasing global hypertension burden, particularly in low-income countries.",
                summaryPoint: "全球高血压负担持续加重，尤其在中低收入国家。"
            }
        ];

        // State
        let state = {
            query: '',
            searchResults: [...MOCK_PAPERS],
            selectedPaperIds: [],
            reviewContent: '',
            isGenerating: false,
            isSearching: false,
            expandedAbstractId: null,
            searchSource: 'live', // 'live' or 'mock'
            errorMsg: null
        };

        // Helper: Enrich paper with simulated IF/JCR
        function enrichPaperData(paper) {
            const citations = paper.citationCount || 0;
            let simulatedIF = (Math.random() * 3 + (citations > 100 ? 10 : citations > 10 ? 3 : 1)).toFixed(1);
            if (citations > 500) simulatedIF = (20 + Math.random() * 30).toFixed(1);
            
            let simulatedJCR = 'Q3';
            if (citations > 50) simulatedJCR = 'Q2';
            if (citations > 150) simulatedJCR = 'Q1';

            return {
                ...paper,
                if: paper.if || simulatedIF,
                jcr: paper.jcr || simulatedJCR,
                summaryPoint: paper.summaryPoint || `${paper.title} (${paper.journal || 'Journal'}, ${paper.year}).`
            };
        }

        // Search Function
        async function executeSearch() {
            if (!state.query.trim()) return;

            state.isSearching = true;
            state.errorMsg = null;
            state.searchResults = [];
            render();

            if (state.searchSource === 'mock') {
                // Mock search
                setTimeout(() => {
                    const lowerText = state.query.toLowerCase().trim();
                    state.searchResults = MOCK_PAPERS.filter(paper => 
                        paper.title.toLowerCase().includes(lowerText) ||
                        paper.keywords.some(k => k.toLowerCase().includes(lowerText)) ||
                        paper.journal.toLowerCase().includes(lowerText)
                    );
                    state.isSearching = false;
                    render();
                }, 600);
            } else {
                // Live API Search (Semantic Scholar)
                try {
                    const limit = 10;
                    const fields = 'paperId,title,authors,year,venue,abstract,citationCount,tldr';
                    const url = `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(state.query)}&limit=${limit}&fields=${fields}`;

                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.data && data.data.length > 0) {
                        state.searchResults = data.data.map(item => ({
                            id: item.paperId,
                            title: item.title,
                            authors: item.authors && item.authors.length > 0 ? `${item.authors[0].name} et al.` : 'Unknown Authors',
                            journal: item.venue || 'Unknown Journal',
                            year: item.year || 'N/A',
                            citationCount: item.citationCount || 0,
                            keywords: [],
                            abstract: item.abstract || (item.tldr ? item.tldr.text : 'No abstract available.'),
                            summaryPoint: item.tldr ? item.tldr.text : null
                        })).map(enrichPaperData);
                    } else {
                        state.searchResults = [];
                    }
                } catch (err) {
                    console.error("Search failed:", err);
                    state.errorMsg = "连接 API 失败，请检查网络或稍后重试。已自动切换回演示数据。";
                    const lowerText = state.query.toLowerCase().trim();
                    state.searchResults = MOCK_PAPERS.filter(paper => 
                        paper.title.toLowerCase().includes(lowerText) || 
                        paper.keywords.some(k => k.toLowerCase().includes(lowerText))
                    );
                } finally {
                    state.isSearching = false;
                    render();
                }
            }
        }

        function togglePaperSelection(id) {
            if (state.selectedPaperIds.includes(id)) {
                state.selectedPaperIds = state.selectedPaperIds.filter(pId => pId !== id);
            } else {
                state.selectedPaperIds.push(id);
            }
            render();
        }

        function getSelectedPapers() {
            return state.searchResults.filter(p => state.selectedPaperIds.includes(p.id));
        }

        function generateReview() {
            if (state.selectedPaperIds.length === 0) return;
            
            state.isGenerating = true;
            state.reviewContent = '';
            render();

            setTimeout(() => {
                const selectedDocs = getSelectedPapers();
                const topic = state.query ? `关于"${state.query}"的` : '';
                
                let text = `## ${topic}文献综述初稿\n\n`;
                text += `**摘要：** 本文综述了 ${selectedDocs.length} 篇相关领域的重要文献，重点探讨了该主题的最新研究进展。\n\n`;
                
                text += `### 1. 核心研究发现\n`;
                selectedDocs.forEach((doc) => {
                    const content = doc.summaryPoint || (doc.abstract ? doc.abstract.substring(0, 120) + "..." : doc.title);
                    text += `* **${doc.authors} (${doc.year})** 在 *${doc.journal}* 发表的研究表明：${content}\n`;
                });

                text += `\n### 2. 综合分析\n`;
                const avgYear = Math.round(selectedDocs.reduce((acc, curr) => acc + (curr.year || 2020), 0) / selectedDocs.length);
                const highImpactDocs = selectedDocs.filter(d => d.citationCount > 50);
                
                text += `本次选取的文献平均发表年份为 ${avgYear} 年。`;
                if (highImpactDocs.length > 0) {
                    text += ` 其中，${highImpactDocs[0].authors} 的研究具有较高的引用影响力（${highImpactDocs[0].citationCount}次引用），显示了该方向在学术界的高关注度。\n\n`;
                } else {
                    text += ` 这些研究为理解 ${state.query || '该领域'} 提供了基础证据。\n\n`;
                }
                
                text += `### 3. 结论\n`;
                text += `现有证据支持进一步开展深入研究，以验证上述发现在更广泛人群中的适用性。`;

                state.reviewContent = text;
                state.isGenerating = false;
                render();
            }, 1500);
        }

        function toggleAbstract(id) {
            state.expandedAbstractId = state.expandedAbstractId === id ? null : id;
            render();
        }

        function clearSelection() {
            state.selectedPaperIds = [];
            render();
        }

        function setSearchSource(source) {
            state.searchSource = source;
            render();
        }

        // Render
        function render() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="flex flex-col h-screen overflow-hidden">
                    <!-- Header -->
                    <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shrink-0 z-10">
                        <div class="flex items-center space-x-3">
                            <div class="bg-indigo-600 p-2 rounded-lg text-white">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-xl font-bold text-slate-900">医学文献综述助手</h1>
                                <p class="text-xs text-slate-500">Medical Literature Review Assistant (Connected)</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="flex bg-slate-100 rounded-lg p-1 border border-slate-200">
                                <button 
                                    onclick="setSearchSource('live')"
                                    class="px-3 py-1 text-xs font-medium rounded-md flex items-center transition-all ${state.searchSource === 'live' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}"
                                >
                                    <svg class="w-3 h-3 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    联网检索 (API)
                                </button>
                                <button 
                                    onclick="setSearchSource('mock')"
                                    class="px-3 py-1 text-xs font-medium rounded-md flex items-center transition-all ${state.searchSource === 'mock' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}"
                                >
                                    <svg class="w-3 h-3 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414" stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                    本地演示库
                                </button>
                            </div>
                        </div>
                    </header>

                    <!-- Main Content -->
                    <div class="flex flex-1 overflow-hidden">
                        <!-- Left Panel -->
                        <div class="flex-1 flex flex-col min-w-0 border-r border-slate-200 bg-slate-50/50">
                            <!-- Search Bar -->
                            <div class="p-6 bg-white border-b border-slate-200 shadow-sm z-10">
                                <div class="flex gap-2">
                                    <div class="relative flex-1">
                                        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                        <input 
                                            type="text"
                                            placeholder="${state.searchSource === 'live' ? '输入医学关键词联网搜索 (如: Type 2 Diabetes, Alzheimer...)' : '搜索本地演示库 (如: 糖尿病, GLP-1...)'}"
                                            class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                                            value="${state.query}"
                                            onchange="state.query = this.value;"
                                            onkeydown="if(event.key==='Enter') executeSearch();"
                                        />
                                    </div>
                                    <button 
                                        onclick="executeSearch()"
                                        ${state.isSearching ? 'disabled' : ''}
                                        class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl transition-colors flex items-center disabled:opacity-70"
                                    >
                                        ${state.isSearching ? '<svg class="animate-spin w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>' : '搜索'}
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between mt-3">
                                    <div class="flex items-center text-xs text-slate-500 space-x-4">
                                        <span>排序: 默认 (Relevance)</span>
                                        <span>已选: ${state.selectedPaperIds.length} 篇</span>
                                    </div>
                                    <div class="text-xs text-slate-400 flex items-center">
                                        ${state.searchSource === 'live' ? `
                                            <svg class="w-3 h-3 mr-1 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                                            </svg>
                                            数据源: Semantic Scholar API
                                        ` : `
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            数据源: 本地模拟数据
                                        `}
                                    </div>
                                </div>
                                
                                ${state.errorMsg ? `
                                    <div class="mt-2 text-xs text-red-500 bg-red-50 p-2 rounded border border-red-100 flex items-center">
                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        ${state.errorMsg}
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Paper List -->
                            <div class="flex-1 overflow-y-auto p-6 space-y-4">
                                ${state.isSearching ? `
                                    <div class="flex flex-col items-center justify-center py-20 text-indigo-600">
                                        <svg class="animate-spin w-10 h-10 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        <p class="text-sm font-medium">正在连接 Semantic Scholar 检索文献...</p>
                                        <p class="text-xs text-slate-400 mt-2">获取标题、摘要、引用数据中</p>
                                    </div>
                                ` : state.searchResults.length === 0 ? `
                                    <div class="text-center py-20 text-slate-400 bg-white rounded-xl border border-dashed border-slate-200 mx-4">
                                        <svg class="w-12 h-12 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                        <p class="font-medium text-slate-600">请输入关键词开始搜索</p>
                                        <div class="mt-4 text-xs bg-slate-50 inline-block px-4 py-3 rounded-lg text-left">
                                            <p class="font-bold mb-1 text-slate-500">提示：</p>
                                            <ul class="list-disc list-inside space-y-1 text-slate-500">
                                                ${state.searchSource === 'live' ? `
                                                    <li>尝试英文关键词效果更好 (e.g. "Lung Cancer")</li>
                                                    <li>支持模糊检索</li>
                                                ` : `
                                                    <li>本地库仅包含: 糖尿病, 高血压, AI 等</li>
                                                `}
                                            </ul>
                                        </div>
                                    </div>
                                ` : state.searchResults.map(paper => `
                                    <div class="bg-white p-5 rounded-xl border ${state.selectedPaperIds.includes(paper.id) ? 'border-indigo-500 ring-1 ring-indigo-500 bg-indigo-50/10' : 'border-slate-200'} hover:shadow-md transition-all animate-in">
                                        <div class="flex items-start gap-4">
                                            <div class="pt-1">
                                                <button 
                                                    onclick="togglePaperSelection('${paper.id}')"
                                                    class="w-5 h-5 rounded border flex items-center justify-center ${state.selectedPaperIds.includes(paper.id) ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-slate-300 hover:border-indigo-400'}"
                                                >
                                                    ${state.selectedPaperIds.includes(paper.id) ? '<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                                                </button>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-start justify-between gap-2">
                                                    <h3 class="font-semibold text-slate-900 leading-snug cursor-pointer hover:text-indigo-700" onclick="toggleAbstract('${paper.id}')">
                                                        ${paper.title}
                                                    </h3>
                                                    <div class="flex flex-col items-end gap-1.5 shrink-0">
                                                        ${paper.if ? `
                                                            <span class="px-2 py-0.5 rounded text-xs font-bold bg-rose-50 text-rose-700 border border-rose-100 whitespace-nowrap" title="Simulated IF">
                                                                IF: ${paper.if}*
                                                            </span>
                                                        ` : ''}
                                                        <span class="px-2 py-0.5 rounded text-xs font-bold bg-blue-50 text-blue-700 border-blue-100 border whitespace-nowrap">
                                                            Cited: ${paper.citationCount}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="mt-1 text-sm text-slate-500 flex items-center flex-wrap gap-x-2">
                                                    <span class="font-medium text-slate-700">${paper.authors}</span>
                                                    <span class="text-slate-300">•</span>
                                                    <span class="italic">${paper.journal}</span>
                                                    <span class="text-slate-300">•</span>
                                                    <span>${paper.year}</span>
                                                </div>
                                                <div class="mt-3">
                                                    <button onclick="toggleAbstract('${paper.id}')" class="text-xs font-medium text-indigo-600 hover:text-indigo-800 flex items-center">
                                                        ${state.expandedAbstractId === paper.id ? '收起摘要 ▲' : '查看摘要 ▼'}
                                                    </button>
                                                    ${state.expandedAbstractId === paper.id ? `
                                                        <div class="mt-2 text-sm text-slate-600 bg-slate-50 p-3 rounded-lg leading-relaxed border border-slate-100">
                                                            ${paper.abstract}
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Right Panel -->
                        <div class="w-[400px] bg-white border-l border-slate-200 flex flex-col shrink-0 shadow-xl">
                            <div class="p-5 border-b border-slate-100 bg-slate-50/50">
                                <h2 class="font-bold text-slate-800 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                    </svg>
                                    综述生成器 (Review Writer)
                                </h2>
                                <p class="text-xs text-slate-500 mt-1">基于选中文献自动生成段落</p>
                            </div>

                            <div class="flex-1 p-5 overflow-y-auto bg-white">
                                ${state.selectedPaperIds.length === 0 ? `
                                    <div class="h-full flex flex-col items-center justify-center text-slate-400 space-y-3">
                                        <svg class="w-12 h-12 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <p class="text-sm text-center px-6">请在左侧勾选至少一篇文献以开始撰写综述</p>
                                    </div>
                                ` : `
                                    <div class="mb-4 flex items-center justify-between">
                                        <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider">已选文献 (${state.selectedPaperIds.length})</span>
                                        <button onclick="clearSelection()" class="text-xs text-red-500 hover:text-red-700 flex items-center">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            清空
                                        </button>
                                    </div>
                                    
                                    <div class="space-y-2 mb-6">
                                        ${getSelectedPapers().map(p => `
                                            <div class="text-xs bg-indigo-50 text-indigo-900 px-3 py-2 rounded-lg border border-indigo-100 flex justify-between items-start gap-2">
                                                <span class="line-clamp-2">${p.title}</span>
                                                <span class="font-bold shrink-0 text-rose-600">IF:${p.if}*</span>
                                            </div>
                                        `).join('')}
                                    </div>

                                    <button 
                                        onclick="generateReview()"
                                        ${state.isGenerating ? 'disabled' : ''}
                                        class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-medium shadow-lg shadow-purple-200 transition-all flex items-center justify-center mb-6 disabled:opacity-70"
                                    >
                                        ${state.isGenerating ? `
                                            <svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                            </svg>
                                            正在分析文献...
                                        ` : `
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                            </svg>
                                            生成综述草稿
                                        `}
                                    </button>

                                    ${state.reviewContent ? `
                                        <div class="animate-in">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="text-sm font-bold text-slate-800">生成结果 preview:</h3>
                                                <button class="text-xs text-indigo-600 hover:underline flex items-center">
                                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                    导出 Word
                                                </button>
                                            </div>
                                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 text-sm text-slate-700 leading-relaxed whitespace-pre-wrap h-[300px] overflow-y-auto" style="font-family: Georgia, serif;">
${state.reviewContent}
                                            </div>
                                            <div class="mt-2 text-xs text-slate-400">
                                                * 注：联网模式下，IF 值为基于引用量估算的模拟值，仅供演示界面布局参考。
                                            </div>
                                        </div>
                                    ` : ''}
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize
        render();
    </script>
</body>
</html>
